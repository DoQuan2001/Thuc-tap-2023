# FTP - File Transfer Protocol

## I. Tổng quan về FTP
### 1.1. Nguồn gốc

Thông số kỹ thuật đầu tiên cho FTP được xuất bản dưới tên RFC 114 vào ngày 16 tháng 4 năm 1971 và được viết bởi Abhay Bhushan, khi đó là sinh viên tại Viện Công nghệ Massachusetts. Ý tưởng ban đầu đằng sau FTP là cho phép truyền tệp qua ARPANET, tiền thân của internet.

### 1.2. FTP là gì


- FTP là viết tắt của Giao thức truyền tệp.
- FTP là một giao thức internet tiêu chuẩn do TCP/IP cung cấp được sử dụng để truyền tệp từ máy chủ này sang máy chủ khác.
- Nó chủ yếu được sử dụng để chuyển các tệp trang web từ người tạo ra chúng sang máy tính hoạt động như một máy chủ cho các máy tính khác trên internet.
- Nó cũng được sử dụng để tải các tệp xuống máy tính từ các máy chủ khác.

### 1.3. Mục đích của giao thức FTP

- Nó cung cấp chia sẻ các tập tin.
- Nó được sử dụng để khuyến khích sử dụng máy tính từ xa.
- Nó truyền dữ liệu đáng tin cậy và hiệu quả hơn
### 1.4. Ưu điểm, nhược điểm

**Ưu điểm của FTP:**
- ***Tốc độ***: Một trong những ưu điểm lớn nhất của FTP là tốc độ. FTP là một trong những cách nhanh nhất để truyền tệp từ máy tính này sang máy tính khác.
- ***Hiệu quả***: Hiệu quả hơn vì chúng tôi không cần phải hoàn thành tất cả các thao tác để lấy toàn bộ tệp.
- ***Bảo mật***: Để truy cập máy chủ FTP, chúng ta cần đăng nhập bằng tên người dùng và mật khẩu. Do đó, chúng ta có thể nói rằng FTP an toàn hơn.
- ***Chuyển động qua lại***: FTP cho phép chúng tôi chuyển các tệp qua lại. Giả sử bạn là người quản lý của công ty, bạn gửi một số thông tin cho tất cả nhân viên và tất cả họ đều gửi lại thông tin trên cùng một máy chủ.

**Nhược điểm của FTP:**

- ***Thiếu mã hóa***: Một nhược điểm lớn của FTP là thiếu tính năng mã hóa tích hợp. Mặc dù yêu cầu tiêu chuẩn trong ngành là các truyền tải FTP phải được mã hóa, nhưng không phải tất cả các nhà cung cấp FTP đều cung cấp tính năng này. Điều này đòi hỏi chúng ta phải tìm kiếm các nhà cung cấp FTP hỗ trợ mã hóa.

- ***Giới hạn kích thước tệp***: FTP chỉ cho phép gửi và nhận các tệp có kích thước tối đa 2GB. Điều này có nghĩa là nếu bạn cần truyền tải các tệp lớn hơn, bạn sẽ gặp hạn chế.

- ***Hạn chế truyền tải đồng thời***: FTP không cho phép bạn chạy các truyền tải đồng thời đến nhiều người nhận. Điều này có nghĩa là bạn chỉ có thể gửi tệp cho một người nhận tại một thời điểm, điều này có thể gây trở ngại trong việc chia sẻ tệp với nhiều người cùng một lúc.

- ***Mật khẩu và nội dung tệp được gửi dưới dạng văn bản rõ ràng***: FTP gửi mật khẩu và nội dung tệp dưới dạng văn bản rõ ràng, điều này tạo điều kiện cho kẻ tấn công nghe trộm thông tin. Vì vậy, có khả năng tấn công bằng cách thử đoán mật khẩu FTP bằng cách dùng brute force.

- ***Không tương thích với mọi hệ thống***: FTP không tương thích với mọi hệ thống. Điều này có nghĩa là bạn có thể gặp khó khăn trong việc kết nối và truyền tải tệp với một số hệ thống hoặc thiết bị..

## II. Nguyên lý hoạt động

### 2.1. Mô hình hoạt động

Không giống như các ứng dụng chạy nền TCP, FTP khonong chỉ cần một kết nối TCP mà các mô hình FTP được thiết kế xung quanh 2 kênh logic trong quá trình giao tiếp giữa clinet FTP và server FTP là **control connection** và **data connection**

![Alt text](https://images.viblo.asia/cda61ae3-5cb4-4256-828c-0785e385defe.png)

- **Control connection**: Đây là kết nối TCP logic chính được tạo ra khi phiên làm việc được thiết lập. Nó được duy trì trong suốt phiên làm việc và chỉ cho các thông tin điều khiển đi qua ví dụ như lệnh và trả lời. Nó không được sử dụng để gửi dữ liệu.

- **Data connection**: Mỗi khi dữ liệu được gửi từ sever tới client hoặc ngược lại, một kết nối dữ liệu TCP riêng biệt được thiết lập giữa chúng. Dữ liệu được truyền qua kết nối này. Khi hoàn tất việc truyền dữ liệu, kết nối được hủy bỏ.

Ngoài hai thành phần trên, tiến trình bên phía người dùng còn có 1 thành phần thứ ba là giao diện người dùng (user interface) dùng để tương tác với người dùng FTP, thành phần này không có ở phía sever.

Như vậy, có hai thành phần trong tiến trình bên phía server và ba thành phần trong tiến trình bên phía client. Các thành phần này được nhắc đến trong các mô hình FTP bằng cái tên cụ thể, được sử dụng trong các tiêu chuẩn để mô tả chi tiết hoạt động của giao thức. Dưới đây là mô hình hoạt động của FTP

![Alt text](https://images.viblo.asia/65c2f535-f88e-4bf5-8c97-b60de27f214e.png)

#### Tiến trình bên phía Server

**Server Protocol Interpreter (Server-PI)**: chịu trách nhiệm quản lý điều khiển kết nối trên server. Nó lắng nghe yêu cầu kết nối hướng từ users trên cổng dành riêng. Khi kết nối đã được thiết lập,nó nhận lện từ User-PI, gửi trả lời lại và quản lí tiến trình truyền dữ liệu trên server.

**Server Data Transfer Process (Server-DTP)**: Làm nhiệm vụ gửi hoặc nhận file từ bộ phận User-DTP. Server DTP vừa làm nhiệm vụ thiết lập kết nối kênh dữ liệu và lắng nghe một kết nối kênh dữ liệu từ user. Nó tương tác với server file trên hệ thống cục bộ để đọc và chép file. 

#### Các tiến trình bên phía Client

**User Interface**: Đây là chương trình được chạy trên máy tính,nó cung cấp giao diện xử lí cho người dùng. Nó cho phép sử dụng các lệnh đơn giản hướng tới người dùng, và cho phép người điều khiển phiên FTP theo dõi được các thông tin và kết quả xảy ra trong tiến trình.

**User Protocol Interpreter (User-PI)**: Chịu trách nhiệm quản lý kênh điều khiển phía Client. Nó khởi tạo phiên kết nối FTP bằng việc phát hiện ra yêu cầu tới phía server-PI. Khi kết nối đã được thiết lập, nó xử lí các lệnh nhận được trên giao diện người dùng, gửi chúng tới Server-PI, và nhận phản hồi trở lại. Nó cũng quản lý tiến trình User-DTP.

**User Data Transfer Process (User-DTP)**: là bộ phận DTP nằm ở phía người dùng, làm nhiệm vụ gửi hoặc nhận dữ liệu từ Server-DTP. User-DTP có thể thiết lập hoặc lắng nghe yêu cầu kết nối kênh dữ liệu trên server. Nó tương tác với thiết bị lưu trữ file phía client.

### 2.2. Nguyên lý hoạt động

1. Thiết lập kết nối: Đầu tiên, máy tính người dùng (Client) thiết lập kết nối với máy chủ FTP (Server) bằng cách sử dụng địa chỉ IP và cổng kết nối FTP (thường là cổng 21).

2. Xác thực: Sau khi kết nối được thiết lập, máy chủ FTP yêu cầu máy tính người dùng cung cấp thông tin đăng nhập, bao gồm tên người dùng và mật khẩu. Thông tin này được sử dụng để xác thực quyền truy cập của người dùng đến các tệp tin trên máy chủ.

3. Truyền tải tệp tin: Khi quá trình xác thực hoàn tất, máy tính người dùng có thể thực hiện các thao tác truyền tải tệp tin. Các lệnh FTP cung cấp cho người dùng khả năng tải lên (upload) tệp tin từ máy tính người dùng lên máy chủ FTP, hoặc tải xuống (download) tệp tin từ máy chủ FTP về máy tính người dùng.

4. Quản lý tệp tin: FTP cung cấp các lệnh để quản lý tệp tin trên máy chủ, bao gồm tạo thư mục mới, xóa tệp tin, đổi tên tệp tin, di chuyển tệp tin, v.v.

5. Đóng kết nối: Khi người dùng hoàn tất các hoạt động truyền tải, họ có thể đóng kết nối với máy chủ FTP. Hoặc trong một số trường hợp, kết nối sẽ tự động đóng sau một khoảng thời gian không hoạt động.
